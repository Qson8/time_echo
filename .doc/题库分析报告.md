# 拾光机 - 题库分析报告

## 📊 当前题库规模

### 题目数量统计

#### 1. 资源文件中的题目
- **文件位置**：`assets/data/sample_questions.json`
- **题目数量**：**150道题目** ✅ **已扩充**
- **用途**：作为示例题目，用于应用初始化和更新

#### 2. 实际存储的题目
- **存储方式**：使用 `JsonStorageService` 存储到本地JSON文件
- **存储位置**：应用数据目录下的 `questions.json` 文件
- **初始状态**：首次安装时，如果本地没有题目，会从 `sample_questions.json` 加载

### 题目分类统计（基于sample_questions.json）

| 分类 | 数量 | 年代分布 |
|------|------|---------|
| 影视 | 50道 ✅ | 80年代：17道，90年代：17道，00年代：16道 |
| 音乐 | 50道 ✅ | 80年代：17道，90年代：17道，00年代：16道 |
| 事件 | 50道 ✅ | 80年代：17道，90年代：17道，00年代：16道 |

### 难度分布

| 难度 | 数量 | 占比 |
|------|------|------|
| 简单 | 50道 ✅ | 33.3% |
| 中等 | 75道 ✅ | 50.0% |
| 困难 | 25道 ✅ | 16.7% |

### 年代分布

| 年代 | 数量 |
|------|------|
| 80年代 | 51道 ✅ |
| 90年代 | 51道 ✅ |
| 00年代 | 48道 ✅ |

### 总计

- **总题目数**：150道 ✅
- **分类均匀分布**：每个分类50道 ✅
- **年代均匀分布**：每个年代约50道 ✅

---

## 🔄 题目释放机制

### 1. 初始化流程

#### 首次安装时
```
应用启动
  ↓
JsonStorageService.initialize()
  ↓
检查 questions.json 是否存在
  ↓
如果不存在 → 从 assets/data/sample_questions.json 加载
  ↓
保存到本地 questions.json
```

**关键代码**：
- `lib/services/json_storage_service.dart` - `_ensureInitialized()`
- 从 `assets/data/sample_questions.json` 加载题目

#### 已安装应用
```
应用启动
  ↓
从本地 questions.json 加载题目
  ↓
直接使用本地题目
```

### 2. 题目更新机制

#### 更新流程
```
用户触发更新 / 应用检测到更新
  ↓
QuestionUpdateService.updateQuestionDatabase()
  ↓
从 assets/data/sample_questions.json 加载所有题目
  ↓
对比已存在的题目（通过ID判断）
  ↓
过滤出数据库中不存在的题目
  ↓
添加新题目到本地存储
  ↓
标记新题目为 isNew = true
  ↓
记录更新日志
```

#### 更新检测
- **检测时机**：应用启动时、手动触发更新
- **检测方法**：`QuestionUpdateService.hasQuestionUpdate()`
- **检测逻辑**：
  1. 从 `assets/data/sample_questions.json` 加载所有题目
  2. 检查每个题目的ID是否已存在于本地存储
  3. 如果有不存在的题目，返回 `true`

#### 新题目标记
- **标记字段**：`isNew`
- **标记时机**：从资源文件加载时自动标记为 `isNew = true`
- **取消标记**：用户查看新题目后，调用 `markNewQuestionsAsRead()` 取消标记

### 3. 题目获取机制

#### 随机获取题目
```dart
QuestionService.getRandomQuestions(int count)
  ↓
从本地存储获取所有题目
  ↓
使用 Random 和 shuffle 随机化
  ↓
返回前 count 个题目
```

#### 按分类获取
- `getQuestionsByCategory(String category)` - 按分类（影视/音乐/事件）
- `getQuestionsByTheme(String theme)` - 按主题（80年代影视等）
- `getQuestionsByDifficulty(String difficulty)` - 按难度（简单/中等/困难）

### 4. 题目数据结构

```dart
class Question {
  int id;                    // 题目ID（唯一标识）
  String content;            // 题目内容
  String category;           // 分类：影视、音乐、事件
  String difficulty;         // 难度：简单、中等、困难
  String echoTheme;          // 主题：80年代影视、90年代音乐等
  List<String> options;      // 选项列表
  int correctAnswer;         // 正确答案索引
  String explanation;        // 答案解析
  bool isNew;                // 是否为新题
  DateTime createdAt;       // 创建时间
}
```

---

## 📈 题目数据流

### 数据流向图

```
assets/data/sample_questions.json (资源文件)
           ↓
    [首次安装/更新时加载]
           ↓
JsonStorageService (JSON存储)
           ↓
questions.json (本地文件)
           ↓
QuestionService (题目服务)
           ↓
应用使用 (答题、收藏等)
```

### 数据存储位置

1. **资源文件**：`assets/data/sample_questions.json`
   - 打包在应用中
   - 只读，不可修改
   - 用于初始化和更新

2. **本地存储**：应用数据目录下的 `questions.json`
   - 可读写
   - 存储用户实际使用的题目
   - 可以包含从资源文件加载的题目，也可以包含后续添加的题目

---

## ✅ 已解决问题

### 1. 题目数量已扩充 ✅
- **现状**：已扩充到150道题目
- **效果**：
  - 每个分类50道，分布均匀
  - 每个年代约50道，覆盖完整
  - 题目丰富，用户体验大幅提升

### 2. 题目分布已优化 ✅
- **分类分布**：影视50道、音乐50道、事件50道
- **年代分布**：80年代51道、90年代51道、00年代48道
- **难度分布**：中等难度为主，符合学习应用特点

## ⚠️ 仍需关注的问题

### 1. 题目更新机制单一
- **现状**：只能从 `sample_questions.json` 更新
- **影响**：
  - 需要修改资源文件才能添加新题目
  - 需要重新打包应用才能更新题目
  - 无法动态扩展题目

### 2. 难度分布已优化 ✅
- **现状**：简单50道(33%)、中等75道(50%)、困难25道(17%)
- **效果**：
  - 简单题目适合初学者，降低入门门槛
  - 中等题目为主，符合大多数用户水平
  - 困难题目增加挑战性，满足进阶需求
  - 难度分布合理，用户体验更好

---

## ✅ 已完成改进

### 1. 扩充题目数量 ✅ **已完成**

#### 完成情况
- ✅ 已扩充到 **150道题目**
- ✅ 覆盖80年代、90年代、00年代
- ✅ 每个分类50道题目
- ✅ 每个年代约50道题目

#### 统计结果
- **总题目数**：150道
- **分类分布**：影视50道、音乐50道、事件50道
- **年代分布**：80年代51道、90年代51道、00年代48道

### 2. 优化题目更新机制

#### 建议
- **分阶段释放**：题目可以分批次释放，而不是一次性全部加载
- **版本管理**：为题目添加版本号，支持增量更新
- **分类更新**：支持按分类更新题目，而不是全部更新

#### 实现方案
```dart
// 题目版本管理
class QuestionVersion {
  int version;           // 版本号
  DateTime releaseDate;  // 发布日期
  List<int> questionIds; // 包含的题目ID列表
}

// 分阶段释放
class QuestionRelease {
  String releaseId;      // 批次ID
  DateTime releaseDate;  // 发布日期
  List<int> questionIds; // 题目ID列表
  bool isUnlocked;       // 是否已解锁
}
```

### 3. 题目分类管理

#### 建议
- **分类统计**：统计各分类的题目数量
- **分类筛选**：支持按分类筛选题目
- **分类进度**：显示各分类的完成进度

---

## 📝 题目数据示例

### 题目文件信息
- **文件位置**：`assets/data/sample_questions.json`
- **文件大小**：约2551行
- **题目总数**：150道

### 题目分布示例

#### 影视分类（50道）
- **80年代影视**（17道）：如《人鬼情未了》《闪灵》《E.T.外星人》《夺宝奇兵》等
- **90年代影视**（17道）：如《还珠格格》《阿甘正传》《泰坦尼克号》《黑客帝国》等
- **00年代影视**（16道）：如《卧虎藏龙》《指环王》《功夫》《阿凡达》等

#### 音乐分类（50道）
- **80年代音乐**（17道）：如《Thriller》《Like a Virgin》《We Are the World》等
- **90年代音乐**（17道）：如《心太软》《吻别》《Smells Like Teen Spirit》等
- **00年代音乐**（16道）：如《至少还有你》《童话》《流星雨》等

#### 事件分类（50道）
- **80年代事件**（17道）：如柏林墙倒塌、苹果公司、切尔诺贝利核事故等
- **90年代事件**（17道）：如苏联解体、香港回归、互联网商业化等
- **00年代事件**（16道）：如9·11事件、北京奥运会、金融危机等

---

## 🎯 总结

### 当前状态
- ✅ 题目存储机制完善（JSON存储）
- ✅ 题目更新机制已实现
- ✅ 题目分类和难度已定义
- ✅ **题目数量已扩充到150道** ✅
- ✅ **已覆盖80年代、90年代、00年代** ✅
- ✅ **每个分类50道，分布均匀** ✅
- ✅ **难度分布已优化**：简单50道、中等75道、困难25道 ✅
- ⚠️ **题目更新需要重新打包应用**（仍需优化，但非紧急）

### 已完成改进
1. ✅ **扩充题目数量**：从10道扩充到150道（15倍增长）
2. ✅ **分类均匀分布**：每个分类50道
3. ✅ **年代均匀分布**：每个年代约50道
4. ✅ **难度分布优化**：简单50道(33%)、中等75道(50%)、困难25道(17%)

### 后续优化建议（可选）
1. **🟡 中优先级**：优化题目更新机制，支持增量更新
2. **🟢 低优先级**：添加题目分类管理功能
3. **🟢 低优先级**：添加题目标签系统，支持多维度筛选

---

**创建时间**：2024年
**分析状态**：已完成


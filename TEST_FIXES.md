# 修复验证测试清单

## 1. 开始拾光失败问题修复验证

### 测试场景 1.1: 首页-开始拾光
**测试步骤：**
1. 打开应用，进入首页
2. 点击"开始拾光"按钮
3. 观察是否正常启动拾光或显示明确的错误提示

**预期结果：**
- ✅ 如果题库有数据：正常启动拾光，进入答题页面
- ✅ 如果题库无数据：显示明确的错误提示"题库中没有题目，请检查数据文件"
- ✅ 如果数据加载失败：显示"数据加载失败，请检查应用数据文件"
- ✅ 错误提示显示4秒，背景为红色

### 测试场景 1.2: 设置-定制题目配置-开始拾光
**测试步骤：**
1. 进入设置页面
2. 进入"定制题目配置"
3. 选择筛选条件（分类、年代、难度）
4. 点击"开始拾光"按钮
5. 观察是否正常启动或显示错误提示

**预期结果：**
- ✅ 如果筛选条件有匹配题目：正常启动拾光
- ✅ 如果筛选条件无匹配题目：显示"没有找到符合条件的题目，请调整筛选条件后重试"
- ✅ 错误提示明确，用户知道如何解决

### 测试场景 1.3: 错误处理验证
**测试步骤：**
1. 模拟各种错误情况（数据库错误、网络错误等）
2. 观察错误提示是否友好

**预期结果：**
- ✅ 所有错误都有明确的提示信息
- ✅ 错误信息帮助用户理解问题
- ✅ 不会出现崩溃或空白页面

---

## 2. 记忆胶囊图片/拍照权限问题修复验证

### 测试场景 2.1: 选择图片
**测试步骤：**
1. 进入"记忆胶囊"页面
2. 点击"新建记忆"
3. 点击"选择图片"按钮
4. 观察是否正常打开相册或显示权限提示

**预期结果：**
- ✅ 如果有权限：正常打开相册，选择图片后显示"图片选择成功"
- ✅ 如果无权限：显示"需要相册访问权限，请在设置中开启"
- ✅ 如果超时：显示"选择图片超时，请重试"
- ✅ 选择成功后，图片显示在页面上

### 测试场景 2.2: 拍照
**测试步骤：**
1. 在新建记忆页面
2. 点击"拍照"按钮
3. 观察是否正常打开相机或显示权限提示

**预期结果：**
- ✅ 如果有权限：正常打开相机，拍照后显示"拍照成功"
- ✅ 如果无权限：显示"需要相机访问权限，请在设置中开启"
- ✅ 如果相机不可用：显示"无法访问相机，请检查相机权限"
- ✅ 拍照成功后，图片显示在页面上

### 测试场景 2.3: 权限配置验证
**测试步骤：**
1. 检查 `ohos/entry/src/main/module.json5` 中的权限配置
2. 检查字符串资源文件中的权限说明

**预期结果：**
- ✅ `ohos.permission.READ_MEDIA` 权限已配置
- ✅ `ohos.permission.WRITE_MEDIA` 权限已配置
- ✅ `ohos.permission.CAMERA` 权限已配置
- ✅ 权限说明字符串已添加到资源文件

---

## 3. 录音权限未弹出问题修复验证

### 测试场景 3.1: 开始录音
**测试步骤：**
1. 在新建记忆页面
2. 点击"开始录音"按钮
3. 观察是否弹出权限提示或显示对话框

**预期结果：**
- ✅ 如果有权限：开始录音，显示"开始录音"提示
- ✅ 如果无权限：弹出对话框，说明需要麦克风权限
- ✅ 对话框内容清晰，说明如何开启权限
- ✅ 提示当前平台可能不支持录音功能

### 测试场景 3.2: 权限配置验证
**测试步骤：**
1. 检查 `ohos/entry/src/main/module.json5` 中的麦克风权限配置

**预期结果：**
- ✅ `ohos.permission.MICROPHONE` 权限已配置
- ✅ 权限说明字符串已添加

---

## 4. 记忆胶囊保存失败问题修复验证

### 测试场景 4.1: 正常保存（有图片和音频）
**测试步骤：**
1. 创建新记忆胶囊
2. 填写标题和内容（必填）
3. 选择图片
4. 录制音频
5. 点击"保存"按钮

**预期结果：**
- ✅ 保存成功，显示"保存成功"提示（绿色背景）
- ✅ 返回记忆胶囊列表，新胶囊显示在列表中
- ✅ 图片和音频都正确保存

### 测试场景 4.2: 保存（仅图片，无音频）
**测试步骤：**
1. 创建新记忆胶囊
2. 填写标题和内容
3. 选择图片
4. 不录制音频
5. 点击"保存"按钮

**预期结果：**
- ✅ 保存成功
- ✅ 图片正确保存
- ✅ 音频字段为空（正常）

### 测试场景 4.3: 保存（无图片，无音频）
**测试步骤：**
1. 创建新记忆胶囊
2. 填写标题和内容
3. 不选择图片，不录制音频
4. 点击"保存"按钮

**预期结果：**
- ✅ 保存成功（仅文本内容也能保存）
- ✅ 图片和音频字段为空（正常）

### 测试场景 4.4: 图片保存失败但记忆胶囊仍能保存
**测试步骤：**
1. 创建新记忆胶囊
2. 填写标题和内容
3. 选择图片（模拟图片保存失败的情况）
4. 点击"保存"按钮

**预期结果：**
- ✅ 显示"图片保存失败，将使用临时路径"提示
- ✅ 记忆胶囊仍然保存成功
- ✅ 不会因为图片保存失败而阻止整个保存流程

### 测试场景 4.5: 存储空间不足
**测试步骤：**
1. 模拟存储空间不足的情况
2. 尝试保存记忆胶囊

**预期结果：**
- ✅ 显示"存储空间不足，请清理空间后重试"
- ✅ 错误提示明确

---

## 5. 收藏后收藏夹不刷新问题修复验证

### 测试场景 5.1: 在题目详情页收藏
**测试步骤：**
1. 进入任意题目详情页
2. 点击收藏图标（星形图标）
3. 观察收藏图标是否立即更新
4. 观察是否显示"已收藏"提示

**预期结果：**
- ✅ 收藏图标立即从空心变为实心（或相反）
- ✅ 显示"已收藏"或"已取消收藏"提示
- ✅ 提示背景颜色正确（收藏为绿色，取消为灰色）

### 测试场景 5.2: 收藏后返回收藏夹
**测试步骤：**
1. 在题目详情页收藏一道题目
2. 返回收藏夹页面
3. 观察收藏的题目是否显示在列表中

**预期结果：**
- ✅ 收藏的题目立即显示在收藏夹列表中
- ✅ 不需要手动刷新
- ✅ 题目按收藏时间排序（最新的在前）

### 测试场景 5.3: 在收藏夹中取消收藏
**测试步骤：**
1. 进入收藏夹页面
2. 长按或进入批量模式
3. 选择题目并取消收藏
4. 观察题目是否从列表中消失

**预期结果：**
- ✅ 取消收藏后，题目立即从列表中移除
- ✅ 列表自动更新，不需要手动刷新

### 测试场景 5.4: 收藏状态同步验证
**测试步骤：**
1. 在题目详情页收藏题目A
2. 进入收藏夹，确认题目A在列表中
3. 返回题目详情页，确认收藏图标为实心
4. 再次点击收藏图标取消收藏
5. 返回收藏夹，确认题目A不在列表中

**预期结果：**
- ✅ 收藏状态在所有页面同步
- ✅ 收藏夹页面自动刷新（通过 didChangeDependencies）
- ✅ 状态一致性良好

---

## 6. 综合测试场景

### 测试场景 6.1: 完整流程测试
**测试步骤：**
1. 启动应用
2. 开始拾光（使用定制配置）
3. 完成答题
4. 在题目详情页收藏题目
5. 进入收藏夹查看收藏
6. 创建记忆胶囊（包含图片）
7. 保存记忆胶囊

**预期结果：**
- ✅ 所有功能正常工作
- ✅ 没有崩溃或错误
- ✅ 用户体验流畅

### 测试场景 6.2: 错误恢复测试
**测试步骤：**
1. 模拟各种错误情况
2. 观察应用是否能优雅处理错误
3. 验证错误后应用仍能正常使用

**预期结果：**
- ✅ 所有错误都有明确的提示
- ✅ 错误不会导致应用崩溃
- ✅ 用户可以继续使用应用

---

## 验证检查清单

### 代码层面验证
- [x] 所有错误处理都包含 try-catch
- [x] 错误信息用户友好
- [x] 权限配置正确
- [x] 收藏刷新机制完整
- [x] 记忆胶囊保存逻辑健壮

### 用户体验验证
- [ ] 错误提示清晰易懂
- [ ] 操作反馈及时
- [ ] 状态同步准确
- [ ] 权限请求合理

### 功能完整性验证
- [ ] 开始拾光功能正常
- [ ] 图片选择/拍照功能正常
- [ ] 录音功能提示正确
- [ ] 记忆胶囊保存功能正常
- [ ] 收藏功能刷新正常

---

## 注意事项

1. **权限测试**：需要在真实设备上测试权限相关功能
2. **数据测试**：需要测试有数据和无数据两种情况
3. **边界测试**：需要测试各种边界情况和错误情况
4. **性能测试**：需要验证刷新机制不会导致性能问题

---

## 测试结果记录

| 测试场景 | 测试结果 | 备注 |
|---------|---------|------|
| 1.1 首页开始拾光 | ⬜ | |
| 1.2 定制配置开始拾光 | ⬜ | |
| 2.1 选择图片 | ⬜ | |
| 2.2 拍照 | ⬜ | |
| 3.1 开始录音 | ⬜ | |
| 4.1 正常保存 | ⬜ | |
| 4.2 仅图片保存 | ⬜ | |
| 4.3 仅文本保存 | ⬜ | |
| 5.1 题目详情页收藏 | ⬜ | |
| 5.2 收藏后返回收藏夹 | ⬜ | |
| 6.1 完整流程 | ⬜ | |


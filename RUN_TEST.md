# 在模拟器上测试修复功能

## 快速开始

### 方法1: 使用测试脚本（推荐）

```bash
# 运行测试脚本
./test_fixes.sh
```

脚本会自动：
1. 检查Flutter环境
2. 列出可用设备
3. 清理旧构建
4. 获取依赖
5. 运行单元测试
6. 启动应用

### 方法2: 手动运行

```bash
# 1. 检查可用设备
flutter devices

# 2. 清理构建
flutter clean

# 3. 获取依赖
flutter pub get

# 4. 运行单元测试
flutter test

# 5. 在HarmonyOS设备上运行
flutter run -d ohos

# 或在Android设备上运行
flutter run -d android

# 或在iOS设备上运行
flutter run -d ios
```

---

## 测试步骤

### 1. 测试开始拾光功能

#### 测试场景 1.1: 首页-开始拾光
1. 启动应用
2. 等待应用加载完成
3. 点击首页的"开始拾光"按钮
4. **预期结果**：
   - ✅ 如果有数据：正常进入答题页面
   - ✅ 如果无数据：显示红色错误提示"题库中没有题目，请检查数据文件"
   - ✅ 错误提示显示4秒

#### 测试场景 1.2: 设置-定制题目配置-开始拾光
1. 进入设置页面
2. 进入"定制题目配置"
3. 选择筛选条件（分类、年代、难度）
4. 点击"开始拾光"按钮
5. **预期结果**：
   - ✅ 如果筛选条件有匹配：正常进入答题页面
   - ✅ 如果筛选条件无匹配：显示红色错误提示"没有找到符合条件的题目，请调整筛选条件后重试"
   - ✅ 错误提示明确，用户知道如何解决

### 2. 测试记忆胶囊图片/拍照功能

#### 测试场景 2.1: 选择图片
1. 进入"记忆胶囊"页面
2. 点击"新建记忆"
3. 点击"选择图片"按钮
4. **预期结果**：
   - ✅ 如果有权限：打开相册，选择图片后显示绿色提示"图片选择成功"
   - ✅ 如果无权限：显示红色提示"需要相册访问权限，请在设置中开启"
   - ✅ 如果超时：显示红色提示"选择图片超时，请重试"
   - ✅ 选择成功后，图片显示在页面上

#### 测试场景 2.2: 拍照
1. 在新建记忆页面
2. 点击"拍照"按钮
3. **预期结果**：
   - ✅ 如果有权限：打开相机，拍照后显示绿色提示"拍照成功"
   - ✅ 如果无权限：显示红色提示"需要相机访问权限，请在设置中开启"
   - ✅ 如果相机不可用：显示红色提示"无法访问相机，请检查相机权限"
   - ✅ 拍照成功后，图片显示在页面上

### 3. 测试录音权限

#### 测试场景 3.1: 开始录音
1. 在新建记忆页面
2. 点击"开始录音"按钮
3. **预期结果**：
   - ✅ 如果有权限：开始录音，显示绿色提示"开始录音"
   - ✅ 如果无权限：弹出对话框，说明需要麦克风权限
   - ✅ 对话框内容清晰，说明如何开启权限
   - ✅ 提示当前平台可能不支持录音功能

### 4. 测试记忆胶囊保存

#### 测试场景 4.1: 正常保存（有图片和音频）
1. 创建新记忆胶囊
2. 填写标题和内容（必填）
3. 选择图片
4. 录制音频（如果支持）
5. 点击"保存"按钮
6. **预期结果**：
   - ✅ 保存成功，显示绿色提示"保存成功"
   - ✅ 返回记忆胶囊列表，新胶囊显示在列表中
   - ✅ 图片和音频都正确保存

#### 测试场景 4.2: 保存（仅文本，无图片和音频）
1. 创建新记忆胶囊
2. 填写标题和内容
3. 不选择图片，不录制音频
4. 点击"保存"按钮
5. **预期结果**：
   - ✅ 保存成功（仅文本内容也能保存）
   - ✅ 图片和音频字段为空（正常）

#### 测试场景 4.3: 图片保存失败但记忆胶囊仍能保存
1. 创建新记忆胶囊
2. 填写标题和内容
3. 选择图片（如果可能，模拟图片保存失败）
4. 点击"保存"按钮
5. **预期结果**：
   - ✅ 显示"图片保存失败，将使用临时路径"提示（如果图片保存失败）
   - ✅ 记忆胶囊仍然保存成功
   - ✅ 不会因为图片保存失败而阻止整个保存流程

### 5. 测试收藏功能刷新

#### 测试场景 5.1: 在题目详情页收藏
1. 进入任意题目详情页
2. 点击收藏图标（星形图标）
3. **预期结果**：
   - ✅ 收藏图标立即从空心变为实心（或相反）
   - ✅ 显示"已收藏"或"已取消收藏"提示
   - ✅ 提示背景颜色正确（收藏为绿色，取消为灰色）

#### 测试场景 5.2: 收藏后返回收藏夹
1. 在题目详情页收藏一道题目
2. 返回收藏夹页面
3. **预期结果**：
   - ✅ 收藏的题目立即显示在收藏夹列表中
   - ✅ 不需要手动刷新
   - ✅ 题目按收藏时间排序（最新的在前）

#### 测试场景 5.3: 在收藏夹中取消收藏
1. 进入收藏夹页面
2. 长按或进入批量模式
3. 选择题目并取消收藏
4. **预期结果**：
   - ✅ 取消收藏后，题目立即从列表中移除
   - ✅ 列表自动更新，不需要手动刷新

---

## 测试检查清单

### 功能测试
- [ ] 开始拾光功能正常（首页）
- [ ] 开始拾光功能正常（设置页面）
- [ ] 选择图片功能正常
- [ ] 拍照功能正常
- [ ] 录音权限提示正常
- [ ] 记忆胶囊保存功能正常（有图片）
- [ ] 记忆胶囊保存功能正常（仅文本）
- [ ] 收藏功能刷新正常
- [ ] 收藏状态同步正常

### 错误处理测试
- [ ] 无数据时错误提示明确
- [ ] 权限不足时错误提示明确
- [ ] 超时错误提示明确
- [ ] 所有错误都有友好的提示

### 用户体验测试
- [ ] 操作反馈及时
- [ ] 状态更新准确
- [ ] 界面流畅无卡顿
- [ ] 没有崩溃或异常退出

---

## 常见问题

### Q: 如何查看应用日志？
A: 运行应用时，日志会显示在终端。也可以使用：
```bash
flutter logs
```

### Q: 如何清除应用数据重新测试？
A: 在设备/模拟器上卸载应用，然后重新安装。

### Q: 如何测试权限相关功能？
A: 需要在真实设备上测试，或者在模拟器设置中手动授予/拒绝权限。

### Q: 如何查看详细的错误信息？
A: 查看终端输出的日志，所有错误都有详细的堆栈信息。

---

## 测试结果记录

| 测试场景 | 测试结果 | 备注 |
|---------|---------|------|
| 1.1 首页开始拾光 | ⬜ | |
| 1.2 定制配置开始拾光 | ⬜ | |
| 2.1 选择图片 | ⬜ | |
| 2.2 拍照 | ⬜ | |
| 3.1 开始录音 | ⬜ | |
| 4.1 正常保存 | ⬜ | |
| 4.2 仅文本保存 | ⬜ | |
| 5.1 题目详情页收藏 | ⬜ | |
| 5.2 收藏后返回收藏夹 | ⬜ | |
| 5.3 在收藏夹中取消收藏 | ⬜ | |

---

## 下一步

测试完成后，请：
1. 记录测试结果
2. 如有问题，记录详细的错误信息
3. 根据测试结果进行进一步优化

